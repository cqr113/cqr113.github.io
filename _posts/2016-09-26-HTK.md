---
layout: post
title:  HTK解码代码分析
date:   2016-09-26 22:20:00 +0800
categories: 语音识别
tag: HTK
---

* content
{:toc}

   每个HMM的每个状态status都有一个TokenSet。这从结构体
_NetInst中可以看出。它有一个链表数据项TokenSet *state，就是保存每个状态status的TokenSet。每个TokenSet.like只保存对应状态的当前时刻观察值的最佳概率（所有状态到当前状态转移概率的最大值乘以观察值的输出概率），这个可以理解为令牌传递给当前时刻每个状态的概率。当这个概率小于pri->genThresh，对应状态的令牌将会被裁剪掉（被置零）。TokenSet.tok.align则保存令牌传递过程的信息。align是一个双向链表，通过这个链表可以追溯识别结果的状态序列。

    struct _NetInst
    {
    struct _NetInst *link; /* Doubly linked list of instances, forward */
    struct _NetInst *knil; /* Doubly linked list of instances, backward */

    NetNode *node;       /* Position of instance within network */

    int flags;           /* Flags, active ... */
    TokenSet *state;     /* TokenSet[0..N-2] in state [1..N-1] for hmm 一个HMM里面的每一个State对应一个TokenSet。保存每个状态的最佳概率*/
    TokenSet *exit;      /* TokenSet in exit state */

    LogFloat wdlk;       /* Max likelihood of t=0 path to word end node */
    LogFloat max;        /* Likelihood for pruning of instance */

    Boolean pxd;         /* External propagation done this frame */
    Boolean ooo;         /* Instance potentially out of order */

     #ifdef SANITY
      int ipos;
     #endif
     };

----------------------------------------------------
    /* A tokenset is effectively a state instance */
    typedef struct tokenset
    {
    short n;                  /* Number of rtok valid (0==1-best, 1>==N-best) */
    RelToken *set;            /* Likelihood sorted array[0..nToks] of rtoks */
    Token tok;                /* Most likely Token in state */
    }
    TokenSet;

--------------------------------------
    /* Tokens are reasonably standard except for extra Align field */
    typedef struct token
     {
    LogDouble like;	/* Likelihood of token */
    LogFloat lm;         /* LM likelihood of token */
    Path *path;		/* Route (word level) through network */
    Align *align;        /* Route (state/model level) through network */
    }
    Token;

-----------------------------------------------
    /* Extra alignments information for state/model level traceback */
    struct align
    {
     short state;         /* State level traceback info */
     NetNode *node;       /* Node for which alignment information present */
     Align *prev;         /* Previous align record */

     LogDouble like;      /* Likelihood upon entering state/model end */
     int frame;           /* Frame number upon entering state/model end */
   
     Boolean used;        /* Reference to struct by current inst */
     int usage;           /* Times struct ref'd (by align or path) */

     Align *link;         /* Next align in list */
     Align *knil;         /* Prev align in list */
     };


